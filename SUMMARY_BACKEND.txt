# FreeNow Backend - Technology & Logic Summary

This file explains the "brain" of the FreeNow platform, focusing on the server-side architecture, real-time communication, and data management.

## üõ†Ô∏è Core Technology Stack

1. **Node.js & Express.js**:
   - The engine of the backend. It handles all API requests (like fetching stats or user lists) and serves as the bridge between the database and the frontend.

2. **Socket.io (Server-Side)**:
   - The core of the "Instant Pulse" philosophy. It manages all active connections.
   - **Rooms**: It dynamically creates virtual "Rooms" for two users when they accept a chat, ensuring their messages are private and never leak to others.

3. **MongoDB (Atlas)**:
   - A powerful Cloud NoSQL database used to store:
     - **Active Users**: Who is currently "Free to Vibe".
     - **Activity Logs**: Tracking every connection, duration, and global milestone.
     - **Long-term Stats**: Counting total connections made this month and legendary connection records.
   - **Migration**: Recently migrated from local MongoDB Compass to a globally distributed MongoDB Atlas cluster for improved reliability and accessibility.

4. **Node-Cron**:
   - An automated task scheduler.
   - **Midnight Cleanup**: Every night at 12:00 AM, it automatically calculates the "Longest Connection of Yesterday," resets daily limits, and clears any stale data to keep the database fast.

5. **Dotenv & CORS**:
   - **Dotenv**: Keeps sensitive data (like MongoDB URLs and API keys) safe and separate from the code.
   - **CORS**: Allows the frontend (on port 3000) to talk safely to the backend (on port 5000).

---

## üß† Smart Logic & Backend Engineering

### 1. The 5-Second Refresh Grace Period (Anti-Ghosting)
- **Problem**: In most apps, if you refresh the page, the server thinks you "Left" and closes the chat.
- **Solution**: A custom timeout logic in the `disconnect` handler.
- **How it works**: When a user's socket disconnects, the server doesn't panic. It waits for **5 seconds**. If the user re-connects within that time (which happens during a refresh), the server cancels the "Close Chat" command. If they don't come back, the server then cleans up safely.

### 2. Real-time Synchronization
- **Events**: `conversation-started` and `conversation-ended`.
- **How it works**: The moment a chat begins or ends, the server broadcasts a message to EVERYONE currently on the landing page. This ensures the "Talking Now" box stays perfectly in sync across the entire globe without anyone needing to refresh their browser.

### 3. Messaging Actions (Edit/Delete)
- **ID Tracking**: Every message is assigned a unique, high-entropy ID (timestamp + random string).
- **Edit Broadcast**: When an `edit-message` event arrives, the server finds everyone in that specific Room and tells their browsers to update the text for that specific ID.
- **Delete Toggle**: Instead of deleting data from the log immediately, the server broadcasts a `message-deleted` event, allowing the frontend to show the "This message was deleted" placeholder for transparency.

### 4. Global Stats Engine
- **Mechanism**: Atomic Increments.
- **How it works**: Instead of re-calculating everything every time, the server uses `$inc` in MongoDB to count connections as they happen. This makes the "Counter" on the landing page extremely fast and efficient, even with thousands of users.

### 5. Stale Session Cleanup
- **Safety Net**: A background logic that automatically marks any chat as "Inactive" if it hasn't seen any movement or if both users are detected as offline. This prevents "Ghost" names from appearing in the Talking Now section.

---

## üè† Project Philosophy: "End-to-End Vibe Security"
- The backend is designed with "Privacy by Design." Conversations are ephemeral; once a room is closed and the activity log is finalized, the messages (which are never stored in the database for long-term) vanish from memory, reflecting the "FreeNow" spirit of living in the moment.
